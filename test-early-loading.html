<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chargement Pr√©coce</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #334155;
            margin-top: 0;
            font-size: 18px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-error { background-color: #ef4444; color: white; }
        .btn-success { background-color: #10b981; color: white; }
        
        .code-example {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin-top: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Test Chargement Pr√©coce</h1>
    <p>Ce test montre comment capturer les erreurs qui surviennent tr√®s t√¥t dans le chargement de la page.</p>
    
    <!-- Test Section 1: Early Errors -->
    <div class="test-section">
        <h2>‚è±Ô∏è Erreurs Pr√©coces</h2>
        <p>Ces erreurs sont g√©n√©r√©es avant que le composant ne soit compl√®tement charg√©.</p>
        <div class="test-buttons">
            <button class="btn-error" onclick="generateEarlyError()">G√©n√©rer Erreur Pr√©coce</button>
            <button class="btn-error" onclick="generateErrorBeforeComponent()">Erreur Avant Composant</button>
            <button class="btn-success" onclick="testEarlyLoading()">Test Chargement Pr√©coce</button>
        </div>
        <div class="code-example">
            // Exemple d'erreur qui survient avant le chargement du composant:
            &lt;script&gt;
            // Ce code est ex√©cut√© avant que le composant ne soit charg√©
            console.error('Erreur tr√®s pr√©coce qui devrait √™tre captur√©e');
            &lt;/script&gt;
        </div>
    </div>
    
    <!-- Test Section 2: Loading Order -->
    <div class="test-section">
        <h2>üì¶ Ordre de Chargement</h2>
        <p>Test de l'ordre dans lequel les scripts sont charg√©s.</p>
        <div class="test-buttons">
            <button class="btn-error" onclick="testScriptLoadOrder()">Test Ordre Scripts</button>
            <button class="btn-error" onclick="testDOMReadyError()">Erreur √† DOMReady</button>
        </div>
    </div>
    
    <!-- Load LitElement first (in head) -->
    <script type="module">
        // Import LitElement as early as possible
        import { LitElement, html, css } from 'https://cdn.jsdelivr.net/gh/lit/dist@2/core/lit-core.min.js';
        window.LitElement = LitElement;
        window.html = html;
        window.css = css;
        
        console.log('‚úÖ LitElement charg√© tr√®s t√¥t');
    </script>
    
    <!-- Load Console Monitor immediately after LitElement -->
    <script type="module" src="/app2/components/console/ss-console-monitor.js"></script>
    
    <!-- Generate some early errors to test -->
    <script>
        // This error should be captured by the early initialization
        console.log('üîç Script ex√©cut√© apr√®s le chargement du console monitor');
        
        // Generate an early error
        setTimeout(() => {
            console.error('‚ö†Ô∏è Erreur g√©n√©r√©e 1 seconde apr√®s le chargement de la page');
        }, 1000);
        
        // Generate a network error
        setTimeout(() => {
            fetch('https://example.com/nonexistent-endpoint-404')
                .catch(error => {
                    console.error('üåê Erreur r√©seau pr√©coce:', error.message);
                });
        }, 1500);
    </script>
    
    <!-- Add the console monitor to the page -->
    <ss-console-monitor></ss-console-monitor>
    
    <script>
        // Test functions
        function generateEarlyError() {
            console.error('Erreur g√©n√©r√©e par bouton - devrait √™tre captur√©e');
            
            // Also generate a network error
            fetch('https://httpstat.us/404')
                .then(response => {
                    if (!response.ok) {
                        console.error('Erreur r√©seau 404 g√©n√©r√©e par bouton');
                    }
                })
                .catch(error => {
                    console.error('Erreur r√©seau catch√©e:', error.message);
                });
        }
        
        function generateErrorBeforeComponent() {
            // Simulate an error that would occur before component loading
            setTimeout(() => {
                try {
                    // This will generate a ReferenceError
                    console.log('Testing early reference error:', nonExistentVariable);
                } catch (error) {
                    console.error('Erreur catch√©e:', error.message);
                }
            }, 50);
        }
        
        function testEarlyLoading() {
            console.log('üöÄ Test du chargement pr√©coce d√©marr√©...');
            
            // Generate multiple types of errors
            console.error('Erreur test 1');
            console.warn('Avertissement test 2');
            
            setTimeout(() => {
                console.error('Erreur asynchrone test 3');
            }, 100);
            
            // Network error
            fetch('https://example.com/nonexistent-test-endpoint')
                .catch(error => {
                    console.error('Erreur r√©seau test 4:', error.message);
                });
            
            alert('Multiple errors generated. Check if all are captured!');
        }
        
        function testScriptLoadOrder() {
            console.log('üìö Testing script load order...');
            
            // Create a script element dynamically
            const script = document.createElement('script');
            script.textContent = `
                console.log('Script dynamique charg√©');
                console.error('Erreur depuis script dynamique');
            `;
            document.body.appendChild(script);
        }
        
        function testDOMReadyError() {
            console.log('üìÑ Testing DOMContentLoaded error...');
            
            // This error should be captured
            console.error('Erreur g√©n√©r√©e √† DOMContentLoaded');
            
            // Also test a network error
            fetch('https://httpstat.us/500')
                .then(response => {
                    if (!response.ok) {
                        console.error('Erreur serveur 500 √† DOMContentLoaded');
                    }
                })
                .catch(error => {
                    console.error('Erreur r√©seau √† DOMContentLoaded:', error.message);
                });
        }
        
        // Log initial
        console.log('üêû Console Monitor Early Loading Test - Ready!');
        console.info('All early errors should be captured by the early initialization.');
    </script>
</body>
</html>