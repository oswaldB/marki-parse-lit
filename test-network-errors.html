<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Erreurs R√©seau</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #334155;
            margin-top: 0;
            font-size: 18px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-error { background-color: #ef4444; color: white; }
        .btn-success { background-color: #10b981; color: white; }
        
        .code-example {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin-top: 10px;
            overflow-x: auto;
        }
        
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .result-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .result-error {
            background-color: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <h1>Test Erreurs R√©seau</h1>
    <p>Ce test v√©rifie que les erreurs r√©seau (404, 500, etc.) sont bien captur√©es par le Console Monitor.</p>
    
    <!-- Test Section 1: Fetch Errors -->
    <div class="test-section">
        <h2>üåê Erreurs Fetch API</h2>
        <p>Test des erreurs avec l'API Fetch moderne.</p>
        <div class="test-buttons">
            <button class="btn-error" onclick="testFetch404()">Fetch 404 Error</button>
            <button class="btn-error" onclick="testFetch500()">Fetch 500 Error</button>
            <button class="btn-error" onclick="testFetchInvalidURL()">Fetch URL Invalide</button>
            <button class="btn-success" onclick="testFetchSuccess()">Fetch Succ√®s (200)</button>
        </div>
        <div id="fetch-result" class="result"></div>
        <div class="code-example">
            // Exemple de code qui g√©n√®re une erreur 404:
            fetch('https://example.com/nonexistent-endpoint')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .catch(error => console.error('Fetch error:', error));
        </div>
    </div>
    
    <!-- Test Section 2: XHR Errors -->
    <div class="test-section">
        <h2>üì° Erreurs XMLHttpRequest</h2>
        <p>Test des erreurs avec l'ancienne API XMLHttpRequest.</p>
        <div class="test-buttons">
            <button class="btn-error" onclick="testXHR404()">XHR 404 Error</button>
            <button class="btn-error" onclick="testXHR500()">XHR 500 Error</button>
            <button class="btn-success" onclick="testXHRSuccess()">XHR Succ√®s (200)</button>
        </div>
        <div id="xhr-result" class="result"></div>
        <div class="code-example">
            // Exemple de code XHR qui g√©n√®re une erreur 404:
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://example.com/nonexistent-endpoint');
            xhr.onload = function() {
                if (xhr.status >= 400) {
                    console.error('XHR error:', xhr.status, xhr.statusText);
                }
            };
            xhr.onerror = function() {
                console.error('XHR network error');
            };
            xhr.send();
        </div>
    </div>
    
    <!-- Test Section 3: Resource Errors -->
    <div class="test-section">
        <h2>üîó Erreurs de Ressources</h2>
        <p>Test des erreurs de chargement de ressources statiques.</p>
        <div class="test-buttons">
            <button class="btn-error" onclick="loadBadImage()">Charger Image 404</button>
            <button class="btn-error" onclick="loadBadScript()">Charger Script 404</button>
            <button class="btn-error" onclick="loadBadStylesheet()">Charger CSS 404</button>
        </div>
        <div id="resource-result" class="result"></div>
    </div>
    
    <!-- Test Section 4: Mixed Tests -->
    <div class="test-section">
        <h2>üß™ Tests Mixtes</h2>
        <p>Combinaison de diff√©rents types d'erreurs.</p>
        <div class="test-buttons">
            <button class="btn-error" onclick="testMultipleErrors()">Plusieurs Erreurs</button>
            <button class="btn-error" onclick="testNetworkThenConsole()">R√©seau puis Console</button>
        </div>
    </div>
    
    <!-- Import LitElement and the console monitor -->
    <script type="module">
        // Import LitElement (simplified for testing)
        import { LitElement, html, css } from 'https://cdn.jsdelivr.net/gh/lit/dist@2/core/lit-core.min.js';
        window.LitElement = LitElement;
        window.html = html;
        window.css = css;
    </script>
    
    <!-- Import the console monitor component -->
    <script type="module" src="/app2/components/console/ss-console-monitor.js"></script>
    
    <!-- Add the console monitor to the page -->
    <ss-console-monitor></ss-console-monitor>
    
    <script>
        // Test functions for Fetch API
        async function testFetch404() {
            const resultDiv = document.getElementById('fetch-result');
            resultDiv.textContent = 'Testing Fetch 404...';
            resultDiv.className = 'result';
            
            try {
                const response = await fetch('https://example.com/nonexistent-endpoint-404');
                resultDiv.textContent = `Response status: ${response.status} (${response.statusText})`;
                resultDiv.className = 'result result-error';
            } catch (error) {
                resultDiv.textContent = `Fetch failed: ${error.message}`;
                resultDiv.className = 'result result-error';
            }
        }
        
        async function testFetch500() {
            const resultDiv = document.getElementById('fetch-result');
            resultDiv.textContent = 'Testing Fetch 500...';
            resultDiv.className = 'result';
            
            // Using a service that returns 500 errors
            try {
                const response = await fetch('https://httpstat.us/500');
                resultDiv.textContent = `Response status: ${response.status} (${response.statusText})`;
                resultDiv.className = 'result result-error';
            } catch (error) {
                resultDiv.textContent = `Fetch failed: ${error.message}`;
                resultDiv.className = 'result result-error';
            }
        }
        
        async function testFetchInvalidURL() {
            const resultDiv = document.getElementById('fetch-result');
            resultDiv.textContent = 'Testing Fetch Invalid URL...';
            resultDiv.className = 'result';
            
            try {
                const response = await fetch('https://this-domain-does-not-exist-12345.com/api');
                resultDiv.textContent = `Response status: ${response.status}`;
                resultDiv.className = 'result result-error';
            } catch (error) {
                resultDiv.textContent = `Fetch failed: ${error.message}`;
                resultDiv.className = 'result result-error';
            }
        }
        
        async function testFetchSuccess() {
            const resultDiv = document.getElementById('fetch-result');
            resultDiv.textContent = 'Testing Fetch Success...';
            resultDiv.className = 'result';
            
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/todos/1');
                const data = await response.json();
                resultDiv.textContent = `Success: ${data.title}`;
                resultDiv.className = 'result result-success';
            } catch (error) {
                resultDiv.textContent = `Fetch failed: ${error.message}`;
                resultDiv.className = 'result result-error';
            }
        }
        
        // Test functions for XMLHttpRequest
        function testXHR404() {
            const resultDiv = document.getElementById('xhr-result');
            resultDiv.textContent = 'Testing XHR 404...';
            resultDiv.className = 'result';
            
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://example.com/nonexistent-endpoint-404');
            xhr.onload = function() {
                if (xhr.status >= 400) {
                    resultDiv.textContent = `XHR Error: ${xhr.status} (${xhr.statusText})`;
                    resultDiv.className = 'result result-error';
                }
            };
            xhr.onerror = function() {
                resultDiv.textContent = 'XHR Network Error';
                resultDiv.className = 'result result-error';
            };
            xhr.send();
        }
        
        function testXHR500() {
            const resultDiv = document.getElementById('xhr-result');
            resultDiv.textContent = 'Testing XHR 500...';
            resultDiv.className = 'result';
            
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://httpstat.us/500');
            xhr.onload = function() {
                if (xhr.status >= 400) {
                    resultDiv.textContent = `XHR Error: ${xhr.status} (${xhr.statusText})`;
                    resultDiv.className = 'result result-error';
                }
            };
            xhr.onerror = function() {
                resultDiv.textContent = 'XHR Network Error';
                resultDiv.className = 'result result-error';
            };
            xhr.send();
        }
        
        function testXHRSuccess() {
            const resultDiv = document.getElementById('xhr-result');
            resultDiv.textContent = 'Testing XHR Success...';
            resultDiv.className = 'result';
            
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://jsonplaceholder.typicode.com/todos/1');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    const data = JSON.parse(xhr.responseText);
                    resultDiv.textContent = `Success: ${data.title}`;
                    resultDiv.className = 'result result-success';
                }
            };
            xhr.onerror = function() {
                resultDiv.textContent = 'XHR Network Error';
                resultDiv.className = 'result result-error';
            };
            xhr.send();
        }
        
        // Test functions for resource errors
        function loadBadImage() {
            const resultDiv = document.getElementById('resource-result');
            resultDiv.textContent = 'Loading bad image...';
            resultDiv.className = 'result';
            
            const img = new Image();
            img.src = 'https://example.com/nonexistent-image-404.jpg';
            img.onerror = function() {
                resultDiv.textContent = 'Image failed to load (404)';
                resultDiv.className = 'result result-error';
            };
            img.onload = function() {
                resultDiv.textContent = 'Image loaded successfully';
                resultDiv.className = 'result result-success';
            };
            document.body.appendChild(img);
        }
        
        function loadBadScript() {
            const resultDiv = document.getElementById('resource-result');
            resultDiv.textContent = 'Loading bad script...';
            resultDiv.className = 'result';
            
            const script = document.createElement('script');
            script.src = 'https://example.com/nonexistent-script-404.js';
            script.onerror = function() {
                resultDiv.textContent = 'Script failed to load (404)';
                resultDiv.className = 'result result-error';
            };
            script.onload = function() {
                resultDiv.textContent = 'Script loaded successfully';
                resultDiv.className = 'result result-success';
            };
            document.body.appendChild(script);
        }
        
        function loadBadStylesheet() {
            const resultDiv = document.getElementById('resource-result');
            resultDiv.textContent = 'Loading bad stylesheet...';
            resultDiv.className = 'result';
            
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://example.com/nonexistent-style-404.css';
            link.onerror = function() {
                resultDiv.textContent = 'Stylesheet failed to load (404)';
                resultDiv.className = 'result result-error';
            };
            link.onload = function() {
                resultDiv.textContent = 'Stylesheet loaded successfully';
                resultDiv.className = 'result result-success';
            };
            document.head.appendChild(link);
        }
        
        // Mixed test functions
        async function testMultipleErrors() {
            console.log('Starting multiple error test...');
            
            // Generate a console error
            console.error('Test error before network calls');
            
            // Generate a network error
            try {
                await fetch('https://example.com/nonexistent-endpoint-404');
            } catch (error) {
                console.error('Network error caught:', error.message);
            }
            
            // Generate another console error
            console.warn('Test warning after network calls');
            
            alert('Multiple errors generated. Check the console monitor!');
        }
        
        async function testNetworkThenConsole() {
            console.log('Starting network then console test...');
            
            // First network error
            try {
                const response = await fetch('https://httpstat.us/404');
                console.log('Response:', response.status);
            } catch (error) {
                console.error('Network error:', error.message);
            }
            
            // Then console error
            console.error('Console error after network call');
            
            // Another network error
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://example.com/nonexistent-xhr-404');
            xhr.send();
            
            alert('Network and console errors generated. Check the console monitor!');
        }
        
        // Initial test
        console.log('Network Error Test Page loaded. Ready to capture network errors!');
    </script>
</body>
</html>