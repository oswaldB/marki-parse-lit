<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemple de Panier - Alpine.js + Lit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Styles personnalis√©s -->
    <link rel="stylesheet" href="./css/styles.css">
    <!-- Lucide Icons via CDN -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Import des composants Lit -->
    <script type="module" src="./components/panier-layout.js"></script>
    <script type="module" src="./components/produit-card.js"></script>
    <script type="module" src="./components/panier-item.js"></script>
    <script type="module" src="./components/notification-toast.js"></script>
    <!-- Script principal -->
    <script type="module" src="./js/main.js"></script>
    <!-- Store des notifications -->
    <script type="module" src="./js/notifications-store.js"></script>
    <!-- Charger Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <panier-layout title="Mon Application Panier" welcome-message="Bienvenue!" show-cart-icon>
        <!-- Contenu principal -->
        <div x-data="{
            produits: [
              { id: 1, nom: 'Pomme', prix: 1.5, image: 'üçé' },
              { id: 2, nom: 'Banane', prix: 0.8, image: 'üçå' },
              { id: 3, nom: 'Orange', prix: 1.2, image: 'üçä' },
              { id: 4, nom: 'Raisin', prix: 2.5, image: 'üçá' },
              { id: 5, nom: 'Poire', prix: 1.8, image: 'üçê' },
              { id: 6, nom: 'Fraise', prix: 3.0, image: 'üçì' }
            ],
            panier: [],
            total: 0,
            
            ajouterAuPanier(e) {
              const produit = e.detail;
              const existe = this.panier.find(item => item.id === produit.id);
              
              if (existe) {
                existe.quantite++;
              } else {
                this.panier.push({ ...produit, quantite: 1 });
              }
              
              this.calculerTotal();
              this.showNotification(`${produit.nom} ajout√© au panier!`);
            },
            
            supprimerDuPanier(e) {
              const id = typeof e === 'object' ? e.detail.id : e;
              const produit = this.panier.find(item => item.id === id);
              this.panier = this.panier.filter(item => item.id !== id);
              this.calculerTotal();
              if (produit) {
                this.showNotification(`${produit.nom} supprim√© du panier`);
              }
            },
            
            calculerTotal() {
              this.total = this.panier.reduce((sum, item) => sum + (item.prix * item.quantite), 0).toFixed(2);
            },
            

            
            showNotification(message) {
              // Utiliser le store centralis√© pour les notifications
              Alpine.store('notifications').add(message, 'info');
            }
          }"
          @ajout-panier="ajouterAuPanier"
          @supprimer-du-panier="supprimerDuPanier"
        >
            <div class="container mx-auto">
                <h2 class="text-2xl font-semibold mb-6">Nos Produits</h2>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-12">
                    <template x-for="produit in produits" :key="produit.id">
                        <produit-card
                            :id="produit.id"
                            :nom="produit.nom"
                            :prix="produit.prix"
                            :image="produit.image"
                        ></produit-card>
                    </template>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Panier -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4">Votre Panier</h3>
                        
                        <div x-show="panier.length === 0" class="text-gray-500 text-center py-8">
                            <p class="mb-2">Votre panier est vide</p>
                            <p class="text-sm">Ajoutez des produits pour commencer vos achats</p>
                        </div>
                        
                        <div x-show="panier.length > 0">
                            <div class="mb-4">
                                <template x-for="item in panier" :key="item.id">
                                    <panier-item
                                        :id="item.id"
                                        :nom="item.nom"
                                        :prix="item.prix"
                                        :quantite="item.quantite"
                                    ></panier-item>
                                </template>
                            </div>
                            
                            <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center font-semibold">
                                <span>Total:</span>
                                <span class="text-xl" x-text="total + ' ‚Ç¨'"></span>
                            </div>
                            
                            <button 
                                class="mt-6 w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded font-medium transition"
                                x-show="panier.length > 0"
                            >
                                Valider la commande
                            </button>
                        </div>
                    </div>
                    
                    <!-- R√©sum√© -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4">R√©sum√© de la commande</h3>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between">
                                <span>Articles:</span>
                                <span x-text="panier.length"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Livraison:</span>
                                <span>Gratuite</span>
                            </div>
                            <div class="flex justify-between font-semibold text-lg">
                                <span>Total:</span>
                                <span x-text="total + ' ‚Ç¨'"></span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <button 
                                class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded transition"
                                :disabled="panier.length === 0"
                            >
                                Continuer les achats
                            </button>
                            <button 
                                class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded transition"
                                :disabled="panier.length === 0"
                            >
                                Proc√©der au paiement
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pied de page personnalis√© -->
        <div slot="footer">
            <div class="flex flex-col items-center gap-2">
                <div class="flex gap-6 text-sm">
                    <a href="#" class="hover:underline">Conditions g√©n√©rales</a>
                    <a href="#" class="hover:underline">Politique de confidentialit√©</a>
                    <a href="#" class="hover:underline">Contact</a>
                </div>
            </div>
        </div>
    </panier-layout>
    
    <!-- Notifications avec Alpine.js x-for et composant Lit -->
    <div x-data class="fixed bottom-4 right-4 z-50 space-y-2">
        <template x-for="notification in $store.notifications.notifications" :key="notification.id">
            <notification-toast 
                :message="notification.message" 
                :type="notification.type"
            ></notification-toast>
        </template>
    </div>
</body>
</html>