<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion - Marki-parse</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Initialisation des couleurs pour Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              DEFAULT: '#509EE3',
              dark: '#236CB9'
            },
            secondary: '#6D5DCF',
            success: '#4CAF50',
            error: '#F44336',
            text: {
              DEFAULT: '#333333',
              light: '#666666'
            },
            border: '#CCCCCC',
            'bg-light': '#F5F7FA'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif']
          }
        }
      }
    };
  </script>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Axios pour les requêtes API -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- Script pour les credentials Parse -->
  <script src="/components/parse-credentials.js"></script>
  <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
  <!-- État Alpine.js pour la page login -->
  <script src="/login/loginState.js"></script>
  <!-- Lit Element pour le composant de redirection -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/lit@2.0.0/+esm"></script>
  <!-- Composant check-login-redirect -->
  <script type="module" src="/components/check-login-redirect.js"></script>
</head>
<body class="bg-gray-100" x-data="loginState()" x-init="init()">
  <!-- Composant check-login-redirect pour vérifier si l'utilisateur est déjà connecté -->
  <check-login-redirect></check-login-redirect>

  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
      <!-- Logo -->
      <div class="flex justify-center mb-8">
        <img src="/assets/marki-logo.png" alt="Logo Marki-parse" class="h-16">
      </div>

      <!-- Titre -->
      <h1 class="text-2xl font-bold text-text text-center mb-6">Connexion</h1>

      <!-- Formulaire de connexion -->
      <form @submit.prevent="login" class="space-y-6">
        <!-- Champ Identifiant -->
        <div>
          <label for="username" class="block text-text font-medium mb-1">Identifiant</label>
          <input
            type="text"
            id="username"
            class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            placeholder="Votre identifiant"
            x-model="username"
            required
          >
        </div>

        <!-- Champ Mot de passe -->
        <div>
          <label for="password" class="block text-text font-medium mb-1">Mot de passe</label>
          <input
            type="password"
            id="password"
            class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            placeholder="Votre mot de passe"
            x-model="password"
            required
          >
        </div>

        <!-- Case à cocher "Se souvenir de moi" -->
        <div class="flex items-center">
          <input
            id="remember"
            type="checkbox"
            class="h-4 w-4 text-primary focus:ring-primary border-border rounded"
            x-model="rememberMe"
          >
          <label for="remember" class="ml-2 block text-text-light">
            Se souvenir de moi
          </label>
        </div>

        <!-- Bouton de connexion -->
        <div>
          <button
            type="submit"
            class="w-full bg-primary text-white px-4 py-2 rounded-md font-medium hover:bg-primary-dark transition-colors"
            :disabled="isLoading"
          >
            <span x-show="!isLoading">Se connecter</span>
            <span x-show="isLoading" class="flex items-center justify-center">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Connexion en cours...
            </span>
          </button>
        </div>

        <!-- Message d'erreur -->
        <div x-show="errorMessage" class="p-3 rounded-md bg-error bg-opacity-10 border border-error text-error text-center">
          <span x-text="errorMessage"></span>
        </div>
      </form>
    </div>
  </div>
</body>
</html>